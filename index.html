<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Small web things</title>

    <style>
        body {
            margin: 30px;
        }
    </style>

    <script>
        /*
            Script for Thing 8 - Mini JS console, script is here instead of in its section because we want to get a high priority script execution to capture all output as soon as possible
        */

        const old_log = console.log;
        const old_error = console.error;
        const old_warn = console.warn;

        let messages = [];

        console.log = function (...args) {
            var msg = {...args}[0];
            messages.push(msg);
            const lgevent = new Event("log");
            lgevent.message = msg;
            // lgevent.type = "log";
            lgevent.loglevel = "log";
            document.dispatchEvent(lgevent);

            old_log.apply(this, arguments);
        }

        console.error = function (...args) {
            var msg = {...args}[0];
            messages.push(msg);
            const lgevent = new Event("log");
            lgevent.message = msg;
            // lgevent.type = "error";
            lgevent.loglevel = "error";
            document.dispatchEvent(lgevent);

            old_error.apply(this, arguments);
        }

        console.warn = function (...args) {
            var msg = {...args}[0];
            messages.push(msg);
            const lgevent = new Event("log");
            lgevent.message = msg;
            // lgevent.type = "warn";
            lgevent.loglevel = "warn";
            document.dispatchEvent(lgevent);

            old_warn.apply(this, arguments);
        }

        window.onerror = function (msg, url, lineNo, columnNo, error) {
            // send to console
            const lgevent = new Event("log");
            const source = "(index)";
            lgevent.message = `${error}<br/>&nbsp;&nbsp;&nbsp;&nbsp;at ${source}:${lineNo}:${columnNo}`;
            // lgevent.type = "error";
            lgevent.loglevel = "error";
            document.dispatchEvent(lgevent);
        }
    </script>

</head>

<body>
    <header>
        <h1>Small web things</h1>
        <h6>just some small web things written in plain HTML JS and CSS. View the page's source to see the all the code in one file</h6>
    </header>
    <hr />
    <main>
        <section>
            <h4>Thing 1 - Spring slider</h4>
            <input id="t1-slider" type="range" min="-1" max="1" step="0.01" />
            <p id="t1-value">0</p>
            <p id="t1-vel">0</p>
            <p id="t1-accel">0</p>
            <script>
                const slider = document.querySelector("#t1-slider");
                const value = document.querySelector("#t1-value");
                const vel = document.querySelector("#t1-vel");
                const accel = document.querySelector("#t1-accel");

                let isHolding = false;
                let acceleration;
                let velocity;
                let damp;

                let t1_interval;

                slider.addEventListener("mousedown", () => {
                    isHolding = true;
                    clearInterval(t1_interval);
                });

                slider.addEventListener("mouseup", () => {
                    isHolding = false;

                    // make slider act like a spring, settling at 0
                    clearInterval(t1_interval);

                    acceleration = -slider.value / 600;
                    velocity = 0;
                    damp = 0.001;

                    t1_interval = setInterval(() => {
                        slider.value -= velocity;

                        if (slider.value > 0) {
                            acceleration = -damp;
                        } else if (slider.value < 0) {
                            acceleration = damp;
                        }



                        velocity -= acceleration;
                        slider.dispatchEvent(new Event("input"));
                    }, 1);
                });

                slider.addEventListener("input", (e) => {
                    value.innerHTML = slider.value;
                    vel.innerHTML = velocity;
                    accel.innerHTML = acceleration;
                    slider.style.transform = `rotate(${slider.value * 1}deg)`;
                });


            </script>
        </section>
        <section>
            <h4>Thing 2 - Infinite slider</h4>
            <input id="t2-slider" type="range" min="1" max="2" step="1" value="1" />
            <p id="t2-value">0</p>
            <script>
                const slider2 = document.querySelector("#t2-slider");
                const value2 = document.querySelector("#t2-value");

                slider2.addEventListener("input", (e) => {
                    value2.innerHTML = slider2.value;
                    slider2.max = parseInt(slider2.value) + 1;
                });
            </script>
        </section>
        <section>
            <h4>Thing 3 - A game of chance</h4>
            <h6>For each of the rows of checkbox pairs, choose one to click. One is safe. The other is not. See how far you can make it.</h6>
            <input type="range" min="2" max="20" step="1" value="5" id="t3_num_pairs"></input><span id="t3_num_pairs_text" style="padding-left: 1rem;"><span id="t3_n_rows_span">5</span> rows = 1 in <span id="t3_1_in_span">32</span> = <span id="t3_percent_span">3.125</span>%</span>
            <p id="t3_status">-</p>
            <table>
                <tbody id="t3_tbody">
                    <tr>
                        <td><input type="checkbox" id="t3-1-1" name="t3-1-1" value="1"></td>
                        <td><input type="checkbox" id="t3-1-2" name="t3-1-2" value="2"></td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" id="t3-2-1" name="t3-2-1" value="4"></td>
                        <td><input type="checkbox" id="t3-2-2" name="t3-2-2" value="8"></td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" id="t3-3-1" name="t3-3-1" value="16"></td>
                        <td><input type="checkbox" id="t3-3-2" name="t3-3-2" value="32"></td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" id="t3-4-1" name="t3-4-1" value="64"></td>
                        <td><input type="checkbox" id="t3-4-2" name="t3-4-2" value="128"></td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" id="t3-5-1" name="t3-5-1" value="256"></td>
                        <td><input type="checkbox" id="t3-5-2" name="t3-5-2" value="512"></td>
                    </tr>

                    <script>
                        const status = document.querySelector("#t3_status");

                        function t3_setStatus(text) {
                            status.innerText = text;
                        }

                        // get ref to the slider
                        const slider3 = document.querySelector("#t3_num_pairs");
                        let t3_num_pairs = slider3.value;

                        // get ref to tbody
                        const tbody = document.querySelector("#t3_tbody");

                        // get ref to all the spans
                        const t3_n_rows_span = document.querySelector("#t3_n_rows_span");
                        const t3_1_in_span = document.querySelector("#t3_1_in_span");
                        const t3_percent_span = document.querySelector("#t3_percent_span");

                        slider3.addEventListener("input", (e) => {
                            t3_setStatus("-");
                            t3_lose();
                            
                            t3_num_pairs = slider3.value;
                            
                            // remove all rows from tbody
                            while (tbody.firstChild) {
                                tbody.removeChild(tbody.firstChild);
                            }
                            
                            // add right number of rows to tbody
                            for (let i = 1; i <= t3_num_pairs; i++) {
                                const tr = document.createElement("tr");
                                for (let j = 1; j <= 2; j++) {
                                    const td = document.createElement("td");
                                    const checkbox = document.createElement("input");
                                    checkbox.type = "checkbox";
                                    checkbox.id = `t3-${i}-${j}`;
                                    checkbox.name = `t3-${i}-${j}`;
                                    checkbox.value = Math.pow(2, (i - 1) * 2 + (j - 1));
                                    td.appendChild(checkbox);
                                    tr.appendChild(td);
                                }
                                tbody.appendChild(tr);
                            }
                            
                            // update the spans
                            t3_n_rows_span.innerText = t3_num_pairs;
                            t3_1_in_span.innerText = Math.pow(2, t3_num_pairs);
                            t3_percent_span.innerText = (1 / Math.pow(2, t3_num_pairs) * 100).toFixed(4);

                            t3_get_cb_refs();
                            t3_lose();
                        });

                        // get references to all the checkboxes in a 2d array
                        let checkboxes = [];

                        function t3_get_cb_refs(){
                            checkboxes = [];
                            for (let i = 1; i <= t3_num_pairs; i++) {
                                checkboxes.push([]);
                                for (let j = 1; j <= 2; j++) {
                                    checkboxes[i - 1].push(document.querySelector(`#t3-${i}-${j}`));
    
                                    // disable the checkboxes
                                    checkboxes[i - 1][j - 1].disabled = true;
                                }
                            }
                        }

                        t3_get_cb_refs();


                        // for each row, enable both checkboxes and check them, and add a click event listener to both. then wait for the user's choice to reveal the next set
                        let t3_row = 0;

                        function t3_next() {
                            // if the user has made it to the end, congratulate them
                            if (t3_row >= t3_num_pairs) {
                                t3_setStatus("You win!");
                                return;
                            } else {
                                t3_setStatus("Score: " + t3_row + "");
                            }

                            // enable the checkboxes
                            checkboxes[t3_row][0].disabled = false;
                            checkboxes[t3_row][1].disabled = false;

                            // // disable previous checkboxes
                            if (t3_row > 0) {
                                checkboxes[t3_row - 1][0].disabled = true;
                                checkboxes[t3_row - 1][1].disabled = true;
                            }

                            // check the checkboxes
                            checkboxes[t3_row][0].checked = true;
                            checkboxes[t3_row][1].checked = true;

                            // add a click event listener to both checkboxes
                            checkboxes[t3_row][0].addEventListener("click", t3_check);
                            checkboxes[t3_row][1].addEventListener("click", t3_check);

                            // increment the row
                            t3_row++;
                        }
                        function t3_lose() {
                            t3_setStatus("Try Again");

                            // disable all the checkboxes
                            for (let i = 1; i <= t3_num_pairs; i++) {
                                for (let j = 1; j <= 2; j++) {
                                    checkboxes[i - 1][j - 1].disabled = true;
                                    checkboxes[i - 1][j - 1].checked = false;
                                }
                            }

                            t3_row = 0;

                            // move on to the next row
                            t3_next();
                        }

                        function t3_check() {
                            if (Math.random() < 0.5) {
                                t3_next();
                            } else {
                                t3_lose();
                            }
                        }

                        // start the game
                        t3_next();

                    </script>
                </tbody>
            </table>
        </section>
        <section>
            <h4>Thing 4 - CSS Editor with zero JS</h4>
            <h6>This section contains zero javascript; the editor below the box is an html &lt;style> tag with the "style_block" class applied to it. The css for that id showed in the editor box makes it visible, and adding the HTML attribute "contenteditable" makes it editable.</h6>
            <div class="box">
                Hello World!
            </div>
            <style class="style_block" contenteditable="">/* Edit this class and watch the box update in real-time */
            
.box {
  background-color: aquamarine;
  width: fit-content;
  padding: 5px;
  transition: all 0.5s;
}

.box:hover {
  background-color: violet;
  transform: scale(1.1);
}

/* applied to html style tag. view-source to see whats happening */

.style_block {
    display: block; 
    width: fit-content;
    border: 1px 
    black solid; 
    white-space: pre; 
    font-family: monospace; 
    padding: 5px; 
    margin-top: 10px;
}
</style>
        </section>
        <section>
            <h4>Thing 5 - JS Editor with zero JS</h4>
            <h6>Read the paragraph inside the script editor below for an explanation; basically the same thing as above but this time we need to re-eval the code to make it run.</h6>
            <button type="button" id="t5_button">Hi, I am <b><i>t5_button</i></b></button>
            <script id="script_block" class="style_block" contenteditable="">/* Basically the same thing as the CSS editor for editing.
Executing the script is harder though, because when you edit the script tag,
you don't actually edit the event listener. Instead we use a workaround where 
we eval the script tag's innerText when the button is clicked. That means 
that everything in the editor is re-run when you click the button. */

const button = document.querySelector("#t5_button")
button.addEventListener("click", () => {
    eval(document.querySelector("#script_block").innerText);
});

// TRY UNCOMMENTING THE NEXT LINE (then press the button!)
// alert("Hello World!");
            </script>
        </section>
        <section>
            <h4>Thing 6 - Iframe Inception</h4>
            <h6>This usually wouldn't work but we can use JS to grab the full HTML for the document and inject it into the iframe instead of just setting the source of the iframe to "window.location.href"</h6>

            <div class="t6_controls">
                <input id="t6_rot_slider" style="margin-bottom: 1rem;" type="range" min="0" max="360" step="0.1" value="0"/><span style="padding-left: 1rem;">rotation: <span id="t6_deg_span" style="font-family: monospace;">0deg</span></span><br/>
                <input id="t6_scale_slider" style="margin-bottom: 1rem;" type="range" min="-1" max="1.1" step="0.1" value="1"/><span style="padding-left: 1rem;">scale: <span id="t6_scale_span" style="font-family: monospace;">1</span></span>
            </div>

            <iframe id="t6_iframe" src="" loading="eager"></iframe>

            
            <style>
                #t6_iframe {
                    /* width: 100%; */
                    /* height: 20rem; */
                    aspect-ratio: 16/9; 
                }
                .t6_controls {
                    margin-bottom: 2rem;
                }
            </style>
            <script>
                const t6_rot_slider = document.querySelector("#t6_rot_slider");
                const t6_deg_span = document.querySelector("#t6_deg_span");

                t6_rot_slider.addEventListener("change", () => {
                    t6_deg_span.innerText = t6_rot_slider.value + "deg";
                    document.querySelector("#t6_iframe").style.rotate = `${t6_rot_slider.value}deg`;
                    render();
                });

                t6_rot_slider.addEventListener("input", () => {
                    t6_deg_span.innerText = t6_rot_slider.value + "deg";
                    document.querySelector("#t6_iframe").style.rotate = `${t6_rot_slider.value}deg`;
                });

                const t6_scale_slider = document.querySelector("#t6_scale_slider");
                const t6_scale_span = document.querySelector("#t6_scale_span");

                t6_scale_slider.addEventListener("change", () => {
                    t6_scale_span.innerText = t6_scale_slider.value;
                    document.querySelector("#t6_iframe").style.scale = `${t6_scale_slider.value}`;
                    render();
                });

                t6_scale_slider.addEventListener("input", () => {
                    t6_scale_span.innerText = t6_scale_slider.value;
                    document.querySelector("#t6_iframe").style.scale = `${t6_scale_slider.value}`;
                });

                function render(){
                    let document_html = document.querySelector("html").innerHTML;
                    function onEntry(entry) {
                        entry.forEach(change => {
                            if(change.isIntersecting){
                                const t6_iframe = document.querySelector("#t6_iframe");
                                t6_iframe.srcdoc = document_html;
                            }
                        });
                    }
                    
                    let observer = new IntersectionObserver(onEntry, {});
                    observer.observe(document.querySelector("#t6_iframe"));
                }
                window.addEventListener("load", render);
            </script>
        </section>
        <section>
            <h4>Thing 7 - Toy calculator</h4>

            <table class="t7_table">
                <tbody>
                    <tr>
                        <td colspan="4"><input id="t7_display" type="text" value="0" disabled></td>
                    </tr>
                    <tr>
                        <td><button id="t7_7">7</button></td>
                        <td><button id="t7_8">8</button></td>
                        <td><button id="t7_9">9</button></td>
                        <td><button id="t7_divide">/</button></td>
                    </tr>
                    <tr>
                        <td><button id="t7_4">4</button></td>
                        <td><button id="t7_5">5</button></td>
                        <td><button id="t7_6">6</button></td>
                        <td><button id="t7_multiply">*</button></td>
                    </tr>
                    <tr>
                        <td><button id="t7_1">1</button></td>
                        <td><button id="t7_2">2</button></td>
                        <td><button id="t7_3">3</button></td>
                        <td><button id="t7_subtract">-</button></td>
                    </tr>
                    <tr>
                        <td><button id="t7_0">0</button></td>
                        <td><button id="t7_decimal">.</button></td>
                        <td><button id="t7_equals">=</button></td>
                        <td><button id="t7_add">+</button></td>
                    </tr>
                    <tr>
                        <td colspan="4"><button id="t7_clear">clear</button><span> Ti-84</span></td>
                    </tr>
                </tbody>
            </table>
            <style>
                .t7_table {
                    border-collapse: collapse;
                    border: 5px ridge whitesmoke;
                    display: flex;
                    flex-direction: column;
                    width: fit-content;
                }

                .t7_table>tbody {
                    border-collapse: collapse;
                    display: flex;
                    flex-direction: column;
                    padding: 5px;
                    /* width: fit-content; */
                }

                /* Buttons */
                .t7_table>*>*>*>* {
                    font-family: monospace;
                    font-size: 10pt;
                }

                /* Display */
                .t7_table>tbody>tr>td>#t7_display {
                    /* width: 50%; */
                    font-family: monospace;
                    font-size: 10pt;
                    text-align: right;
                    width: 110px;
                }

                /* make gap smaller */
                .t7_table>tbody>tr>td {
                    /* width: 0px; */
                    padding: 3px;
                    /* background-color: black; */
                }
            </style>
            <script>
                // get refs to all the buttons in a dict
                const buttons = {};
                for (let i = 0; i < 10; i++) {
                    buttons[i] = document.querySelector(`#t7_${i}`);
                }
                buttons["."] = document.querySelector("#t7_decimal");   
                buttons["="] = document.querySelector("#t7_equals");
                buttons["/"] = document.querySelector("#t7_divide");
                buttons["*"] = document.querySelector("#t7_multiply");
                buttons["-"] = document.querySelector("#t7_subtract");
                buttons["+"] = document.querySelector("#t7_add");
                buttons["clear"] = document.querySelector("#t7_clear");

                // get ref to the display
                const display = document.querySelector("#t7_display");

                let buffer = 0;
                let answer_buffer = 0;
                let operator;
                let isFloat = false;

                buttons["clear"].addEventListener("click", () => {
                    buffer = 0;
                    display.value = "0";
                    isFloat = false;
                    answer_buffer = 0;
                    operator = undefined;
                });

                for (let i = 0; i < 10; i++) {
                    buttons[i].addEventListener("click", () => {
                        if (answer_buffer == 0 && operator != undefined) {
                            answer_buffer = buffer
                            buffer = 0;
                            // console.log("here");
                        }
                        if (isFloat) {
                            buffer = parseFloat(buffer.toString() + '.' + i.toString());
                            isFloat = false;
                        } else if (buffer.toString().includes(".")) {
                            buffer = parseFloat(buffer.toString() + i.toString());
                        } else {
                            buffer = parseInt(buffer.toString() + i.toString());
                        }
                        display.value = buffer;
                        // console.log(buffer);
                        // console.log(buffer.isFloat);
                    });
                }

                buttons["."].addEventListener("click", () => {
                    if (buffer.toString().includes(".")) {
                        return;
                    }
                    isFloat = true;
                    buffer = parseFloat(buffer.toString()+".");
                    display.value = buffer+'.';
                });

                buttons["="].addEventListener("click", () => {
                    if (operator == undefined) {
                        return;
                    }
                    switch (operator) {
                        case "/":
                            buffer = answer_buffer / buffer;
                            break;
                        case "*":
                            buffer = answer_buffer * buffer;
                            break;
                        case "-":
                            buffer = answer_buffer - buffer;
                            break;
                        case "+":
                            buffer = answer_buffer + buffer;
                            break;
                    }
                    display.value = buffer;
                    // answer_buffer = buffer;
                    // buffer = 0;
                    answer_buffer = 0;
                    operator = undefined;
                    isFloat = false;
                });

                const operators = ["+", "-", "*", "/"];
                operators.forEach((op) => {
                    buttons[op].addEventListener("click", () => {
                        if(answer_buffer == 0){
                            operator = op;
                            answer_buffer = buffer;
                            buffer = 0;
                            display.value = buffer;
                            isFloat = false;
                        } else {
                            // do the calculation and move the answer into the buffer
                            buttons["="].click();
                            // set the operator
                            operator = op;
                        }
                    });
                });

            </script>
        </section>
        <section>
            <h4>Thing 8 - Mini JS console</h4>
            <h6>This section uses a script to hijack the windows console object to add a listner that reports to this box. So any errors or console messages from the entire site will report here. You can try using your browsers developer tools to send a console.log message and it will show up here.</h6>
            <div id="t8_output" style="width: 100%; height: 10rem; font-family: monospace; font-size: 10pt; border: 1px solid; border-radius: 2px; margin-bottom: 5px;overflow: scroll;"></div>
            <input id="t8_input" type="text"></input>

            <script>
                const t8_output = document.querySelector("#t8_output");
                const t8_input = document.querySelector("#t8_input");

                /*
                    PSSST! There's extra code for this thing in the <head> of this document. It needs to be there for higher script execution priority.
                */

                t8_input.addEventListener("keydown", (e) => {
                    if (e.key == "Enter") {
                        t8_output.innerHTML += `<span style="color: grey;">> ${t8_input.value}</span><br/>`;
                        try {
                            let op = eval(t8_input.value);
                            if (op != undefined) {
                                t8_output.value += op + "\n";
                            }
                            // t8_output.value += op + "\n";
                        } catch (e) {
                            t8_output.innerHTML += `<span style="color: red;">${e}</span><br/>`;
                        }
                        t8_input.value = "";
                    }
                });

                document.addEventListener("log", (e) => {
                    const color = {
                        "log": "black",
                        "error": "red",
                        "warn": "orange"
                    }[e.loglevel];

                    // use innerHTML so that we have colors
                    t8_output.innerHTML += `<span style="color: ${color};"> ${e.message}</span><br/>`;
                });
            </script>
        </section>
        <section>
            <h4>Thing 9 - The 2FA Game</h4>
            <h6>You know when your using 2FA and you need to quickly enter your auth code from your phone to you computer before it expires? Thats what this game is. </h6>
            <input type="range" min="100" max="2000" value="1000" id="t9_timeout" style="margin-bottom: 20px;"></input><span style="padding-left: 1rem;">Difficulty (&lt;- easy | hard ->)</span>
            <div class="t9_auth_app">
                <h6>Super 2FA</h6>
                <p>Hover to show code: <span class="t9_hidden" id="t9_code">000000</span></p>
                <progress id="t9_progress" value="0" max="100"></progress>
            </div>
            <input id="t9_input" type="text" placeholder="Enter 2FA Code"></input>

            <style>
                .t9_auth_app {
                    display: flex;
                    flex-direction: column;
                    margin-bottom: 1rem;
                    border: 5px ridge tomato;
                    width: fit-content;
                    padding: 1rem;
                    align-items: center;
                    /* justify-content: center; */
                    /* width: 100%; */
                    /* height: 100%; */
                    /* font-family: monospace; */
                    /* font-size: 10pt; */

                }

                .t9_auth_app > h6 {
                    margin-bottom: 10px;
                }

                .t9_auth_app > * {
                    margin: 2px;
                }

                .t9_auth_app > progress {
                    /* align-self: center; */
                    /* margin-top: 10px; */
                    width: 50%;
                }

                .t9_hidden {
                    background-color: black;
                }
                .t9_hidden:hover {
                    background-color: transparent;
                }
            </style>
            
            <script>
                // get refs
                const t9_code = document.querySelector("#t9_code");
                const t9_input = document.querySelector("#t9_input");
                const t9_progress = document.querySelector("#t9_progress");
                const t9_timeout_slider = document.querySelector("#t9_timeout");

                let t9_timeout = t9_timeout_slider.value;

                t9_timeout_slider.addEventListener("input", () => {
                    t9_timeout = t9_timeout_slider.value;
                    // document.querySelector("#t9_timeout_span").innerText = t9_timeout;
                });

                function t9_updateCode() {
                    t9_code.innerText = Math.floor(Math.random() * 1000000).toString().padStart(6, "0");
                    t9_progress.value = 0;
                }

                // update progress bar, and make the code update when the progress bar is full
                let t9_interval;
                t9_interval = setInterval(() => {
                    t9_progress.value += 100 / t9_timeout;
                    if (t9_progress.value >= 100) {
                        t9_updateCode();
                    }
                }, 1);

                t9_updateCode();

                // if input is correct alert
                t9_input.addEventListener("keydown", (e) => {
                    if (e.key == "Enter") {
                        if (t9_input.value == t9_code.innerText) {
                            alert("Logged in!");
                            t9_updateCode();
                        } else {
                            alert("Incorrect code");
                        }
                        t9_input.value = "";
                    }
                });

                // remove focus from input when hovering over code
                t9_code.addEventListener("mouseover", () => {
                    t9_input.blur();
                });                
            </script>
        </section>
    </main>
</body>

</html>